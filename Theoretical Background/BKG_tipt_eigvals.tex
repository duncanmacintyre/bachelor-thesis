The goal of this section is to compute the second-order perturbative corrections to the eigenvalues of an operator. We use the approach known as time-independent perturbation theory.

Suppose \(\op{\rho}\) is an operator with eigenstates \(\ket{\Psi_n}\) and eigenvalues \(\sigma_n\). Suppose we have the asymptotic expansions
\begin{align*}
\op{\rho} &= \op{\rho}_0 + \lambda \op{\rho}_1 + \lambda^2 \op{\rho}_2 + \Od{\lambda^3} \\
\ket{\Psi_n} &= \ket{\Psi_n^{(0)}} + \lambda \ket{\Psi_n^{(1)}} + \lambda^2 \ket{\Psi_n^{(2)}} + \Od{\lambda^3} \\
\sigma_n &= \sigma_n^{(0)} + \lambda \sigma_n^{(1)} + \lambda^2 \sigma_n^{(2)} + \Od{\lambda^3}
\end{align*}
where \(\left\{\ket{\Psi_n^{(0)}}\right\}\) is an orthonormal basis for the Hilbert space.

We have \(\op{\rho} \ket{\Psi_n} = \sigma_n \ket{\Psi_n}\). In the zeroth order of \(\lambda\) this gives \(\op{\rho}_0 \ket{\Psi_n^{(0)}} = \sigma_n^{(0)} \ket{\Psi_n^{(0)}}\), that is, \(\ket{\Psi_n^{(0)}}\) is an eigenstate of \(\op{\rho}_0\) with eigenvalue \(\sigma_n^{(0)}\).

Now, we have
\begin{align*}
\sigma_n \ket{\Psi_n} &= \op{\rho}\ket{\Psi_n}\\
\left(\sigma_n^{(0)} - \sigma_m^{(0)} + \lambda \sigma_n^{(1)} + \lambda^2 \sigma_n^{(2)} + \Od{\lambda^3} \right)\braket{\Psi_m^{(0)}}{\Psi_n} &=\bra{\Psi_m^{(0)}} \lambda \op{\rho}_1 + \lambda^2 \op{\rho}_2 + \Od{\lambda^3} \ket{\Psi_n} \\
\braket{\Psi_m^{(0)}}{\Psi_n} &=\frac{\bra{\Psi_m^{(0)}} \lambda \op{\rho}_1 + \lambda^2 \op{\rho}_2 + \Od{\lambda^3} \ket{\Psi_n}}{\sigma_n^{(0)} - \sigma_m^{(0)} + \lambda \sigma_n^{(1)} + \lambda^2 \sigma_n^{(2)} + \Od{\lambda^3}}.
\end{align*}
We will next proceed to get rid of the denominator by using the Taylor expansion \(\frac{1}{1+x} = 1-x +\Od{x^2}\).

Let \(D_n\) be the indices degenerate with \(n\). That is, let \(D_n = \{m : \sigma_m^{(0)} = \sigma_n^{(0)}\}\).
Consider the case where \(m \in D_n\). Let \(\delta\) be a small real number. In the limit as \(\delta \to 0\),
\begin{align*}
\braket{\Psi_m^{(0)}}{\Psi_n} &=\frac{\bra{\Psi_m^{(0)}} \lambda \op{\rho}_1 + \lambda^2 \op{\rho}_2 + \Od{\lambda^3} \ket{\Psi_n}}{\lambda \sigma_n^{(1)} + \lambda^2 \sigma_n^{(2)} + \Od{\lambda^3} + \lambda\delta} \\
&=\frac{\bra{\Psi_m^{(0)}} \lambda \op{\rho}_1 + \lambda^2 \op{\rho}_2 + \Od{\lambda^3} \ket{\Psi_n}}{\lambda \left(\sigma_n^{(1)}+ \delta\right)\left(1 + \lambda \frac{\sigma_n^{(2)}}{\sigma_n^{(1)}+\delta} + \Od{\lambda^2}\right) } \\
&=\frac{\bra{\Psi_m^{(0)}} \op{\rho}_1 + \lambda \op{\rho}_2 + \Od{\lambda^2} \ket{\Psi_n}}{\sigma_n^{(1)}+ \delta}\left(1 - \lambda \frac{\sigma_n^{(2)}}{\sigma_n^{(1)}+\delta} + \Od{\lambda^2}\right) \\
&= \frac{\bra{\Psi_m^{(0)}} \left(\op{\rho}_1 + \lambda \op{\rho}_2 + \Od{\lambda^2} \right)\left(\ket{\Psi_n^{(0)}} + \lambda \ket{\Psi_n^{(1)}} + \Od{\lambda^2}\right)}{\sigma_n^{(1)}+\delta}
\left(1 - \lambda \frac{\sigma_n^{(2)}}{\sigma_n^{(1)}+\delta} + \Od{\lambda^2}\right) \\
&=\frac{\bra{\Psi_m^{(0)}} \op{\rho}_1 \ket{\Psi_n^{(0)}}}{\sigma_n^{(1)} + \delta} + \lambda \left[\frac{\bra{\Psi_m^{(0)}}\op{\rho}_2\ket{\Psi_n^{(0)}}}{\sigma_n^{(1)} + \delta} + \frac{\bra{\Psi_m^{(0)}}\op{\rho}_2\ket{\Psi_n^{(1)}}}{\sigma_n^{(1)} + \delta} - \frac{\sigma_n^{(2)}\bra{\Psi_m^{(0)}}\op{\rho}_2\ket{\Psi_n^{(0)}}}{\left(\sigma_n^{(1)} + \delta\right)^2}\right] + \Od{\lambda^2}
\end{align*}
(The \(\delta\) ensured that we did not divide by zero if \(\sigma_n^{(1)}=0\).) Now consider the case where \(m \not\in D_n\). Then
\begin{align*}
\braket{\Psi_m^{(0)}}{\Psi_n} &=\frac{\bra{\Psi_m^{(0)}} \lambda \op{\rho}_1 + \Od{\lambda^2} \ket{\Psi_n}}{\left(\sigma_n^{(0)} - \sigma_m^{(0)}\right)\left(1+\Od{\lambda}\right)} \\
&=\frac{\bra{\Psi_m^{(0)}} \lambda \op{\rho}_1 + \Od{\lambda^2} \ket{\Psi_n}}{\sigma_n^{(0)} - \sigma_m^{(0)}}\left(1 + \Od{\lambda}\right) \\
&= \lambda\frac{\bra{\Psi_m^{(0)}} \op{\rho}_1 \ket{\Psi_n}}{\sigma_n^{(0)} - \sigma_m^{(0)}} + \Od{\lambda^2}.
\end{align*}
Putting this all together,
\begin{align}\label{eq.tiptmaineq}
\ket{\Psi_n} &= \sum_{m \in D_n} \ket{\Psi_m^{(0)}} \braket{\Psi_m^{(0)}}{\Psi_n} + \sum_{m \not\in D_n} \ket{\Psi_m^{(0)}} \braket{\Psi_m^{(0)}}{\Psi_n} \\
&= \sum_{m \in D_n} \ket{\Psi_m^{(0)}} \lim_{\delta\to 0} \frac{\bra{\Psi_m^{(0)}} \op{\rho}_1 \ket{\Psi_n^{(0)}}}{\sigma_n^{(1)} + \delta}
\nonumber\\&\hspace{1.5em}+ \lambda\;\;
\Biggl(\;\sum_{m \in D_n} \ket{\Psi_m^{(0)}} \lim_{\delta \to 0}\left[\frac{\bra{\Psi_m^{(0)}}\op{\rho}_2\ket{\Psi_n^{(0)}}}{\sigma_n^{(1)} + \delta} + \frac{\bra{\Psi_m^{(0)}}\op{\rho}_1\ket{\Psi_n^{(1)}}}{\sigma_n^{(1)} + \delta} - \frac{\sigma_n^{(2)}\bra{\Psi_m^{(0)}}\op{\rho}_0\ket{\Psi_n^{(0)}}}{\left(\sigma_n^{(1)} + \delta\right)^2}\right] 
\nonumber\\&\hspace{6em}+ \sum_{m \not\in D_n} \ket{\Psi_m^{(0)}}\frac{\bra{\Psi_m^{(0)}} \op{\rho}_1 \ket{\Psi_n}}{\sigma_n^{(0)} - \sigma_m^{(0)}}
\;\Biggr)
\nonumber\\&\hspace{1.5em}+ \Od{\lambda^2}\nonumber
\end{align}

In the zeroth order of \(\lambda\), equation (\ref{eq.tiptmaineq}) gives
\[
\ket{\Psi_n^{(0)}} = \sum_{m \in D_n} \ket{\Psi_m^{(0)}} \lim_{\delta\to0}\frac{\bra{\Psi_m^{(0)}} \op{\rho}_1 \ket{\Psi_n^{(0)}}}{\sigma_n^{(1)} + \delta}.
\]
Multiplying by \(\bra{\Psi_n^{(0)}}\) we get
\begin{equation}\label{eq.tipt.foval}
\boxed{\sigma_n^{(1)} = \bra{\Psi_n^{(0)}}\op{\rho}_1\ket{\Psi_n^{(0)}}.}
\end{equation}
If we instead multiply by \(\bra{\Psi_k^{(0)}}\) where \(k \in D_n\) but \(k \neq n\) we get
\begin{equation}\label{eq.tipt.fodiag}
\boxed{0 = \bra{\Psi_k^{(0)}}\op{\rho}_1\ket{\Psi_n^{(0)}}, \hspace{3em} k \in D_n,\hspace{3em} m \neq n.}
\end{equation}
In other words, the matrix given by \(\bra{\Psi_k^{(0)}}\op{\rho}_1\ket{\Psi_j^{(0)}}\) is diagonal on \(k,j\in D_n\), for any \(n\).

In the first order of \(\lambda\), equation (\ref{eq.tiptmaineq}) says
\[
\hspace{-2.5em}
\ket{\Psi_n^{(1)}} = \sum_{m \in D_n} \ket{\Psi_m^{(0)}} \lim_{\delta \to 0}\left[\frac{\bra{\Psi_m^{(0)}}\op{\rho}_2\ket{\Psi_n^{(0)}}}{\sigma_n^{(1)} + \delta} + \frac{\bra{\Psi_m^{(0)}}\op{\rho}_1\ket{\Psi_n^{(1)}}}{\sigma_n^{(1)} + \delta} - \frac{\sigma_n^{(2)}\bra{\Psi_m^{(0)}}\op{\rho}_0\ket{\Psi_n^{(0)}}}{\left(\sigma_n^{(1)} + \delta\right)^2}\right] 
+ \sum_{m \not\in D_n} \ket{\Psi_m^{(0)}}\frac{\bra{\Psi_m^{(0)}} \op{\rho}_1 \ket{\Psi_n}}{\sigma_n^{(0)} - \sigma_m^{(0)}}.
\]
Multiplying by \(\bra{\Psi_k^{(0)}}\) where \(k \not\in D_n\) gives
\[
\braket{\Psi_k^{(0)}}{\Psi_n^{(1)}} = \frac{\bra{\Psi_k^{(0)}} \op{\rho}_1 \ket{\Psi_n^{(0)}}}{\sigma_n^{(0)}-\sigma_k^{(0)}}.
\]
If we instead multiply by \(\bra{\Psi_n^{(0)}}\) we get
\[
0 = \braket{\Psi_n^{(0)}}{\Psi_n^{(1)}} = \lim_{\delta \to 0} \left[\frac{\bra{\Psi_n^{(0)}}\op{\rho}_2\ket{\Psi_n^{(0)}}}{\sigma_n^{(1)} + \delta} + \frac{\bra{\Psi_n^{(0)}}\op{\rho}_1\ket{\Psi_n^{(1)}}}{\sigma_n^{(1)} + \delta} - \frac{\sigma_n^{(2)}\left(\sigma_n^{(1)}+\delta\right)}{\left(\sigma_n^{(1)} + \delta\right)^2}\right]
\]
so
\begin{align*}
\hspace{-2em}\sigma_n^{(2)} &= \bra{\Psi_n^{(0)}}\op{\rho}_2\ket{\Psi_n^{(0)}} + \bra{\Psi_n^{(0)}}\op{\rho}_1\ket{\Psi_n^{(1)}} - \braket{\Psi_n^{(0)}}{\Psi_n^{(1)}} \sigma_n^{(1)}\\
&= \bra{\Psi_n^{(0)}}\op{\rho}_2\ket{\Psi_n^{(0)}} + \sum_{m \in D_n} \bra{\Psi_n^{(0)}}\op{\rho}_1\ket{\Psi_m^{(0)}}\braket{\Psi_m^{(0)}}{\Psi_n^{(1)}} + \sum_{m \not\in D_n} \bra{\Psi_n^{(0)}}\op{\rho}_1\ket{\Psi_m^{(0)}}\braket{\Psi_m^{(0)}}{\Psi_n^{(1)}} - \braket{\Psi_n^{(0)}}{\Psi_n^{(1)}} \sigma_n^{(1)}\\
&= \bra{\Psi_n^{(0)}}\op{\rho}_2\ket{\Psi_n^{(0)}} + \sigma_n^{(1)}\braket{\Psi_n^{(0)}}{\Psi_n^{(1)}} +  \sum_{m \not\in D_n} \bra{\Psi_n^{(0)}}\op{\rho}_1\ket{\Psi_m^{(0)}}\frac{\bra{\Psi_m^{(0)}} \op{\rho}_1 \ket{\Psi_n^{(0)}}}{\sigma_n^{(0)}-\sigma_m^{(0)}}- \braket{\Psi_n^{(0)}}{\Psi_n^{(1)}} \sigma_n^{(1)}
\end{align*}
hence
\begin{equation}\label{eq.tipt.soval}
\boxed{\sigma_n^{(2)} = \bra{\Psi_n^{(0)}}\op{\rho}_2\ket{\Psi_n^{(0)}} +  \sum_{m \not\in D_n} \frac{\left|\bra{\Psi_m^{(0)}} \op{\rho}_1 \ket{\Psi_n^{(0)}}\right|^2}{\sigma_n^{(0)}-\sigma_m^{(0)}}.}
\end{equation}
